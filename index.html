<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Vintage Phenakistoscope Simulator</title>
<style>
  :root{
    --wood:#3a2a19;
    --panel:#22160f;
    --accent:#e8c87a;
    --muted:#bda982;
  }
  body{
    font-family:'Georgia',serif;
    background:
      radial-gradient(circle at center, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.95) 100%),
      url('https://upload.wikimedia.org/wikipedia/commons/8/8d/Wood_background_texture.jpg');
    background-size:cover;
    background-attachment:fixed;
    color:var(--muted);
    margin:0; padding:20px;
    filter:sepia(0.25);
  }
  h1{
    text-align:center;
    color:var(--accent);
    text-shadow:0 0 12px rgba(255,220,140,0.3);
    font-weight:normal;
    margin:0 0 10px;
  }
  .wrap{
    max-width:1100px;
    margin:0 auto;
    display:grid;
    grid-template-columns:360px 1fr;
    gap:20px;
    align-items:start;
  }
  .panel{
    background:linear-gradient(180deg, rgba(30,20,10,0.9), rgba(10,5,2,0.95));
    border:1px solid rgba(255,255,255,0.08);
    border-radius:12px;
    padding:16px;
    box-shadow:0 6px 20px rgba(0,0,0,0.6), inset 0 0 40px rgba(0,0,0,0.7);
  }
  label{display:block;margin:10px 0 6px;color:var(--accent);font-size:13px}
  input,select,button{
    width:100%;box-sizing:border-box;padding:8px;border-radius:8px;
    border:1px solid rgba(255,255,255,0.1);
    background:rgba(0,0,0,0.3);color:var(--muted);
    font-family:'Courier New',monospace;font-size:13px;
  }
  button:hover{background:rgba(255,220,140,0.1);box-shadow:0 0 8px rgba(255,220,140,0.2)}
  .controls{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .viewer{
    display:flex;justify-content:center;align-items:center;height:560px;
    background:radial-gradient(circle at center, rgba(240,200,150,0.1) 0%, rgba(0,0,0,0.95) 100%);
    border-radius:12px;box-shadow:0 0 40px rgba(0,0,0,0.7), inset 0 0 60px rgba(0,0,0,0.8);
    position:relative;
  }
  canvas{
    background:radial-gradient(circle at center, #2b1b0c 0%, #0e0602 100%);
    border-radius:50%;
    box-shadow:0 0 50px rgba(255,220,140,0.15), inset 0 0 40px rgba(0,0,0,0.9);
  }
  .reflection{
    position:absolute;
    bottom:-160px;
    transform:scaleY(-1);
    opacity:0.25;
    filter:blur(2px);
  }
  .note{font-size:12px;color:var(--muted);margin-top:8px;line-height:1.4}
  footer{margin-top:12px;font-size:11px;color:#a6936d;text-align:center}
  .thumb{width:72px;height:72px;border-radius:8px;overflow:hidden;cursor:pointer;border:2px solid transparent}
  .thumb img{width:100%;height:100%;object-fit:cover}
  .thumb.selected{border-color:var(--accent)}
  .examples{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
</style>
</head>
<body>
<h1>Vintage Phenakistoscope Simulator</h1>
<div class="wrap">
  <div class="panel">
    <div class="note">Choose a disc or load your own. Adjust slit and speed to match the original optical illusion seen through a mirror, just as in a 19th-century phenakistoscope.</div>

    <label>Built-in discs</label>
    <div class="examples" id="examples"></div>

    <label>Image URL</label>
    <input id="imgUrl" type="text" placeholder="https://...jpg or png">
    <div class="controls">
      <input id="loadUrl" type="button" value="Load URL">
      <input id="upload" type="file" accept="image/*">
    </div>

    <label>Rotation speed (rotations per second)</label>
    <input id="speed" type="range" min="0" max="6" step="0.05" value="2">

    <div class="controls">
      <div>
        <label>Number of slits</label>
        <input id="slits" type="range" min="4" max="48" step="1" value="12">
      </div>
      <div>
        <label>Slit width (degrees)</label>
        <input id="slitWidth" type="range" min="1" max="40" step="1" value="6">
      </div>
    </div>

    <label>View options</label>
    <div class="controls">
      <div><label><input id="mirror" type="checkbox" checked> Mirror reflection</label></div>
      <div><label><input id="showDisc" type="checkbox" checked> Show disc background</label></div>
    </div>

    <div class="controls" style="margin-top:10px">
      <button id="pause">Pause</button>
      <button id="reset">Reset</button>
    </div>
    <footer>Inspired by Dick Balzer’s phenakistoscope collection</footer>
  </div>

  <div class="panel">
    <div class="viewer">
      <canvas id="canvas" width="720" height="720"></canvas>
      <canvas id="reflection" width="720" height="200" class="reflection"></canvas>
    </div>
    <div class="note">This view simulates what you’d see reflected in a mirror through the slits of a real 1830s disc.</div>
  </div>
</div>

<script>
// --- built-in example discs ---
const examples = [
  {name:'Default (McLean_1)', url:'https://tclaret.github.io/phenakistoscope-simulator/McLean_1.png'},
  {name:'Simple rings', url:'data:image/svg+xml;utf8,' + encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="600" height="600"><rect width="100%" height="100%" fill="#2b1b0c"/><g transform="translate(300,300)">${[...Array(12)].map((_,i)=>`<circle r="${240-i*12}" fill="none" stroke="#e8c87a" stroke-width="1" opacity="${0.2+i*0.05}"/>`).join('')}</g></svg>`)}
];
const examplesEl=document.getElementById('examples');
examples.forEach((ex,i)=>{
  const el=document.createElement('div');el.className='thumb';el.title=ex.name;el.innerHTML=`<img src="${ex.url}">`;
  el.onclick=()=>selectExample(i);examplesEl.appendChild(el);
});
let selectedExample=null;
function selectExample(i){
  selectedExample=i;
  document.querySelectorAll('.thumb').forEach((t,idx)=>t.classList.toggle('selected',idx===i));
  loadImage(examples[i].url);
}

// --- Canvas setup ---
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');
const refl=document.getElementById('reflection');
const rctx=refl.getContext('2d');
let img=null,angle=0,last=performance.now(),running=true;
const speedEl=document.getElementById('speed');
const slitsEl=document.getElementById('slits');
const slitWidthEl=document.getElementById('slitWidth');
const mirrorEl=document.getElementById('mirror');
const showDiscEl=document.getElementById('showDisc');
const pauseBtn=document.getElementById('pause');
const resetBtn=document.getElementById('reset');

pauseBtn.onclick=()=>{running=!running;pauseBtn.textContent=running?'Pause':'Resume';if(running){last=performance.now();requestAnimationFrame(loop);}};
resetBtn.onclick=()=>{angle=0;};
document.getElementById('loadUrl').onclick=()=>{const v=document.getElementById('imgUrl').value.trim();if(v)loadImage(v);};
document.getElementById('upload').addEventListener('change',e=>{
  const f=e.target.files[0];if(!f)return;
  const reader=new FileReader();
  reader.onload=()=>loadImage(reader.result);
  reader.readAsDataURL(f);
});

function loadImage(src){
  const i=new Image();i.crossOrigin='anonymous';
  i.onload=()=>{img=i;};
  i.onerror=()=>alert('Could not load image (check CORS or use Upload).');
  i.src=src;
}
function clear(){ctx.clearRect(0,0,canvas.width,canvas.height);}
function drawDisc(theta){
  if(!img)return;
  const cx=canvas.width/2,cy=canvas.height/2;
  ctx.save();ctx.translate(cx,cy);ctx.rotate(theta);
  const s=Math.min(canvas.width*0.9/img.width,canvas.height*0.9/img.height);
  const w=img.width*s,h=img.height*s;
  ctx.drawImage(img,-w/2,-h/2,w,h);
  ctx.restore();
}
function drawReflectedThroughSlits(theta){
  if(!img)return;
  const cx=canvas.width/2,cy=canvas.height/2;
  const slits=parseInt(slitsEl.value,10);
  const slitDeg=parseFloat(slitWidthEl.value);
  const off=document.createElement('canvas');off.width=canvas.width;off.height=canvas.height;
  const octx=off.getContext('2d');
  octx.translate(off.width/2,off.height/2);
  if(mirrorEl.checked)octx.scale(-1,1);
  octx.rotate(theta);
  const s=Math.min(off.width*0.9/img.width,off.height*0.9/img.height);
  octx.drawImage(img,-img.width*s/2,-img.height*s/2,img.width*s,img.height*s);
  const mask=document.createElement('canvas');mask.width=off.width;mask.height=off.height;
  const mctx=mask.getContext('2d');mctx.translate(mask.width/2,mask.height/2);
  for(let i=0;i<slits;i++){
    const a=(i*2*Math.PI/slits)-0.5*(slitDeg*Math.PI/180);
    const aw=slitDeg*Math.PI/180;
    mctx.beginPath();mctx.moveTo(0,0);
    mctx.arc(0,0,Math.max(mask.width,mask.height),a,a+aw);
    mctx.closePath();mctx.fillStyle='white';mctx.fill();
  }
  octx.globalCompositeOperation='destination-in';
  octx.drawImage(mask,-mask.width/2,-mask.height/2);
  ctx.drawImage(off,0,0);
}
function drawReflection(){
  rctx.save();
  rctx.clearRect(0,0,refl.width,refl.height);
  rctx.drawImage(canvas,0,0,refl.width,refl.height);
  rctx.restore();
}
function loop(ts){
  if(!running)return;
  const dt=(ts-last)/1000;last=ts;
  angle+=dt*parseFloat(speedEl.value)*2*Math.PI;
  clear();
  if(showDiscEl.checked&&img)drawDisc(angle);
  if(img)drawReflectedThroughSlits(angle);
  drawReflection();
  requestAnimationFrame(loop);
}
selectExample(0);
requestAnimationFrame(loop);
</script>
</body>
</html>
