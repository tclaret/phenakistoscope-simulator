<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Vintage Phenakistoscope Simulator</title>
<style>
  /* ===== General Layout ===== */
  body {
    background: radial-gradient(circle at center, #1a0e05 0%, #000 100%), url('https://upload.wikimedia.org/wikipedia/commons/8/8d/Wood_background_texture.jpg');
    background-size: cover;
    color: #e6d9c4;
    font-family: 'Courier New', monospace;
    text-align: center;
    margin: 0;
    padding: 20px;
    filter: sepia(0.3);
  }

  h1 {
    text-shadow: 0 0 20px #e0c27b;
  }

  /* ===== Canvas and Lighting ===== */
  .canvas-wrapper {
    position: relative;
    width: 800px;
    margin: 20px auto;
  }

  canvas {
    display: block;
    background: radial-gradient(circle at center, #3b2a18 0%, #1a0e05 100%);
    border-radius: 50%;
    border: 4px solid #442c16;
    box-shadow:
      0 0 25px rgba(255, 220, 150, 0.3),
      0 0 50px rgba(255, 220, 150, 0.1),
      inset 0 0 40px rgba(0, 0, 0, 0.8);
    filter: sepia(0.4) contrast(1.1) brightness(0.9);
  }

  /* Reflection */
  .reflection {
    transform: scaleY(-1);
    opacity: 0.2;
    filter: blur(2px);
  }

  /* ===== Controls ===== */
  .controls {
    margin-bottom: 20px;
    padding: 15px;
    border-radius: 12px;
    background: linear-gradient(180deg, #3b2b1b, #1f1409);
    box-shadow: inset 0 3px 10px rgba(0,0,0,0.7), 0 3px 15px rgba(0,0,0,0.7);
    display: inline-block;
  }

  button, input[type="file"], input[type="text"], input[type="range"], select {
    margin: 4px;
    padding: 6px 10px;
    border-radius: 8px;
    border: 1px solid #5e4627;
    background: #2a1a0a;
    color: #e6d9c4;
    font-family: 'Courier New', monospace;
    transition: all 0.2s ease-in-out;
  }

  button:hover {
    background: #4c341c;
    box-shadow: 0 0 8px #e0c27b;
  }

  .indicator {
    display: inline-block;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: #421;
    margin-left: 8px;
    box-shadow: 0 0 5px #000;
  }

  .indicator.on {
    background: #ebc46f;
    box-shadow: 0 0 10px #ebc46f;
  }

  #statusMessage {
    color: #d4c19c;
    font-size: 14px;
    margin-top: 8px;
  }

  .speed-control {
    display: inline-flex;
    align-items: center;
    margin: 5px;
  }

  .speed-value {
    width: 50px;
    text-align: right;
    margin-left: 5px;
    color: #ebc46f;
  }

  hr {
    border: 1px solid #3b2b1b;
  }
</style>
</head>
<body>
<h1>Vintage Phenakistoscope Simulator üéûÔ∏è</h1>

<div class="controls">
  <div>
    <input type="file" id="fileInput" accept="image/*" />
    <input type="text" id="imageUrlInput" placeholder="Enter image URL" size="30" />
    <button id="loadUrlBtn">Load URL</button>
  </div>
  <hr>
  <div>
    <button id="startStopBtn">‚ñ∂Ô∏è Start</button>
    <div class="indicator" id="indicator"></div>
    <button id="resetBtn">üîÅ Reset</button>
    <button id="stepLeftBtn">‚ü≤ Step Left</button>
    <button id="stepRightBtn">‚ü≥ Step Right</button>
    <button id="directionBtn">‚Ü∫ Direction: CW</button>
    <div class="speed-control">
      <label for="speedSlider">Speed:</label>
      <input type="range" id="speedSlider" min="0.001" max="0.1" step="0.001" value="0.02" />
      <span class="speed-value" id="speedValue">0.020</span>
    </div>
    <label for="autoStopSelect">Auto-stop:</label>
    <select id="autoStopSelect">
      <option value="0">Off</option>
      <option value="5">5s</option>
      <option value="10">10s</option>
      <option value="30">30s</option>
    </select>
  </div>
</div>

<div class="canvas-wrapper">
  <canvas id="phenakistoscopeCanvas" width="800" height="800"></canvas>
  <canvas id="reflectionCanvas" width="800" height="200" class="reflection"></canvas>
</div>

<p id="statusMessage">Loading vintage plate...</p>

<script>
window.onload = function () {
  const canvas = document.getElementById('phenakistoscopeCanvas');
  const ctx = canvas.getContext('2d');
  const reflectionCanvas = document.getElementById('reflectionCanvas');
  const reflectionCtx = reflectionCanvas.getContext('2d');

  const fileInput = document.getElementById('fileInput');
  const imageUrlInput = document.getElementById('imageUrlInput');
  const loadUrlBtn = document.getElementById('loadUrlBtn');
  const statusMessage = document.getElementById('statusMessage');
  const startStopBtn = document.getElementById('startStopBtn');
  const resetBtn = document.getElementById('resetBtn');
  const stepLeftBtn = document.getElementById('stepLeftBtn');
  const stepRightBtn = document.getElementById('stepRightBtn');
  const directionBtn = document.getElementById('directionBtn');
  const indicator = document.getElementById('indicator');
  const speedSlider = document.getElementById('speedSlider');
  const speedValue = document.getElementById('speedValue');
  const autoStopSelect = document.getElementById('autoStopSelect');

  let image = new Image();
  image.crossOrigin = "anonymous";
  image.src = "https://tclaret.github.io/phenakistoscope-simulator/McLean_1.png";
  image.onload = () => statusMessage.textContent = "‚úÖ Vintage plate loaded (McLean_1.png)";

  let rotation = 0;
  let isRunning = false;
  let rotationSpeed = parseFloat(speedSlider.value);
  let direction = 1;
  let frameCount = 12;
  let currentFrame = 0;
  let autoStopTimer = null;

  function drawPhenakistoscopeMirror() {
    ctx.save();
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // soft radial light
    const grad = ctx.createRadialGradient(canvas.width/2, canvas.height/2, 100, canvas.width/2, canvas.height/2, 400);
    grad.addColorStop(0, "rgba(255,240,200,0.15)");
    grad.addColorStop(1, "rgba(0,0,0,0.9)");
    ctx.fillStyle = grad;
    ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.translate(canvas.width / 2, canvas.height / 2);
    ctx.scale(-1, 1);
    ctx.rotate(rotation);

    const anglePerFrame = (2 * Math.PI) / frameCount;
    const startAngle = currentFrame * anglePerFrame;
    const endAngle = startAngle + anglePerFrame;

    ctx.beginPath();
    ctx.moveTo(0, 0);
    ctx.arc(0, 0, canvas.width / 2, startAngle, endAngle);
    ctx.closePath();
    ctx.clip();

    if (image.complete && image.naturalWidth > 0) {
      ctx.drawImage(image, -canvas.width / 2, -canvas.height / 2, canvas.width, canvas.height);
    }
    ctx.restore();

    // slit guides
    ctx.save();
    ctx.strokeStyle = "rgba(235,196,111,0.4)";
    ctx.lineWidth = 1.1;
    for (let i = 0; i < frameCount; i++) {
      const a = (i / frameCount) * 2 * Math.PI;
      const x = canvas.width / 2 + Math.cos(a) * (canvas.width / 2 - 10);
      const y = canvas.height / 2 + Math.sin(a) * (canvas.height / 2 - 10);
      ctx.beginPath();
      ctx.moveTo(canvas.width / 2, canvas.height / 2);
      ctx.lineTo(x, y);
      ctx.stroke();
    }
    ctx.restore();
  }

  function drawReflection() {
    reflectionCtx.save();
    reflectionCtx.clearRect(0, 0, reflectionCanvas.width, reflectionCanvas.height);
    reflectionCtx.drawImage(canvas, 0, 0, reflectionCanvas.width, reflectionCanvas.height);
    reflectionCtx.restore();
  }

  function animate() {
    if (isRunning) {
      rotation += direction * rotationSpeed;
      currentFrame = (currentFrame + 1) % frameCount;
    }
    drawPhenakistoscopeMirror();
    drawReflection();
    requestAnimationFrame(animate);
  }
  animate();

  /* Controls */
  fileInput.addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = ev => {
      image = new Image();
      image.onload = () => statusMessage.textContent = `‚úÖ Loaded image: ${file.name}`;
      image.src = ev.target.result;
    };
    reader.readAsDataURL(file);
  });

  loadUrlBtn.addEventListener("click", () => {
    const url = imageUrlInput.value.trim();
    if (!url) return;
    const img = new Image();
    img.crossOrigin = "anonymous";
    img.onload = () => {
      image = img;
      statusMessage.textContent = `‚úÖ Image loaded from URL: ${url}`;
    };
    img.onerror = () => statusMessage.textContent = "‚ùå Could not load image (CORS restriction).";
    img.src = url;
  });

  startStopBtn.addEventListener("click", () => {
    isRunning = !isRunning;
    indicator.classList.toggle("on", isRunning);
    startStopBtn.textContent = isRunning ? "‚è∏ Stop" : "‚ñ∂Ô∏è Start";
    statusMessage.textContent = isRunning ? "üü¢ Rotation started." : "‚è∏ Rotation paused.";

    if (isRunning) {
      clearTimeout(autoStopTimer);
      const duration = parseInt(autoStopSelect.value);
      if (duration > 0) {
        autoStopTimer = setTimeout(() => {
          isRunning = false;
          indicator.classList.remove("on");
          startStopBtn.textContent = "‚ñ∂Ô∏è Start";
          statusMessage.textContent = `‚èπ Auto-stopped after ${duration}s.`;
        }, duration * 1000);
      }
    }
  });

  resetBtn.addEventListener("click", () => {
    rotation = 0;
    currentFrame = 0;
    statusMessage.textContent = "üîÅ Rotation reset.";
  });

  stepLeftBtn.addEventListener("click", () => {
    rotation -= 0.1;
    statusMessage.textContent = "‚ü≤ Stepped left.";
  });

  stepRightBtn.addEventListener("click", () => {
    rotation += 0.1;
    statusMessage.textContent = "‚ü≥ Stepped right.";
  });

  directionBtn.addEventListener("click", () => {
    direction *= -1;
    directionBtn.textContent = direction === 1 ? "‚Ü∫ Direction: CW" : "‚Üª Direction: CCW";
    statusMessage.textContent = direction === 1 ? "‚û°Ô∏è Clockwise rotation." : "‚¨ÖÔ∏è Counterclockwise rotation.";
  });

  speedSlider.addEventListener("input", () => {
    rotationSpeed = parseFloat(speedSlider.value);
    speedValue.textContent = rotationSpeed.toFixed(3);
  });
};
</script>
</body>
</html>
